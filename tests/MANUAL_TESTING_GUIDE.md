# Руководство по ручному тестированию регистрации на турнир

## Подготовка к тестированию

### Требования
1. Запущенный dev сервер: `npm run dev`
2. В базе данных должны быть:
   - Турнир со статусом `REGISTRATION_OPEN`
   - Спортсмены (Athlete)
   - Тренеры (Coach)
   - Судьи (Judge)
   - Пользователь с ролью `RegionalRepresentative`

### Тестовые аккаунты
- **Региональный представитель**: может подавать заявки
- **Администратор**: может одобрять/отклонять заявки

---

## СЦЕНАРИЙ 1: Регистрация через страницу турнира

### Шаги
1. Открыть `/ru/tournaments`
2. Найти турнир со статусом "Регистрация открыта"
3. Нажать "Подробнее" или "Регистрация"
4. Авторизоваться (если не авторизован)

### Тест 1.1: Выбор существующего спортсмена
- [ ] Открыть форму регистрации `/ru/tournaments/apply?tournamentId=[id]`
- [ ] Выбрать категорию турнира
- [ ] В поле "Судья" начать вводить имя
- [ ] Убедиться что появился выпадающий список с поиском
- [ ] Выбрать судью из списка
- [ ] В секции "Спортсмены" нажать на поле выбора
- [ ] Выбрать спортсмена из списка
- [ ] Выбрать тренера из списка
- [ ] Нажать "Подать заявку"
- [ ] **Ожидаемый результат**: Заявка создана, показан номер заявки

### Тест 1.2: Добавление нового спортсмена
- [ ] Открыть форму регистрации
- [ ] Выбрать категорию и судью
- [ ] В секции "Спортсмены" нажать "Добавить нового"
- [ ] Заполнить модальное окно:
  - ИИН (12 цифр)
  - Проверить автозаполнение: дата рождения, пол, категория
  - ФИО
  - Тип лука
- [ ] Нажать "Добавить"
- [ ] Убедиться что спортсмен отобразился с пометкой "(новый)"
- [ ] Выбрать тренера
- [ ] Подать заявку
- [ ] **Ожидаемый результат**: Заявка создана, новый спортсмен добавлен в базу

### Тест 1.3: Добавление нового тренера
- [ ] Открыть форму регистрации
- [ ] Выбрать категорию и судью
- [ ] Выбрать спортсмена
- [ ] В поле "Тренер" нажать "Добавить нового"
- [ ] Заполнить:
  - ФИО (обязательно)
  - Телефон (опционально)
  - Email (опционально)
- [ ] Нажать "Добавить"
- [ ] Подать заявку
- [ ] **Ожидаемый результат**: Заявка создана, новый тренер добавлен в базу

### Тест 1.4: Добавление нового судьи
- [ ] Открыть форму регистрации
- [ ] Выбрать категорию
- [ ] В поле "Судья" нажать "Добавить нового судью"
- [ ] Заполнить:
  - ФИО (обязательно)
  - Категория судьи (обязательно)
  - Телефон (опционально)
  - Email (опционально)
- [ ] Нажать "Добавить"
- [ ] Убедиться что судья отобразился с пометкой "(новый)"
- [ ] Добавить спортсменов и тренеров
- [ ] Подать заявку
- [ ] **Ожидаемый результат**: Заявка создана, новый судья добавлен в базу

### Тест 1.5: Множественные спортсмены
- [ ] Открыть форму регистрации
- [ ] Выбрать категорию и судью
- [ ] Добавить 3 спортсмена (нажать "Добавить спортсмена" 2 раза)
- [ ] Для каждого:
  - Выбрать спортсмена
  - Выбрать тренера
- [ ] Подать заявку
- [ ] **Ожидаемый результат**: Заявка с 3 спортсменами создана

### Тест 1.6: Удаление спортсмена из списка
- [ ] Добавить 3 спортсмена
- [ ] Нажать кнопку удаления (X) у второго
- [ ] Убедиться что осталось 2 спортсмена
- [ ] **Ожидаемый результат**: Спортсмен удален из формы

---

## СЦЕНАРИЙ 2: Валидация формы

### Тест 2.1: Обязательные поля
- [ ] Открыть форму регистрации
- [ ] Попробовать отправить без выбора категории
- [ ] **Ожидаемый результат**: Ошибка "Выберите категорию турнира"

- [ ] Выбрать категорию, но не выбрать судью
- [ ] Попробовать отправить
- [ ] **Ожидаемый результат**: Ошибка "Выберите судью или добавьте нового"

- [ ] Выбрать судью, но не выбрать спортсмена
- [ ] Попробовать отправить
- [ ] **Ожидаемый результат**: Ошибка "Выберите спортсменов для всех участников"

- [ ] Выбрать спортсмена, но не выбрать тренера
- [ ] Попробовать отправить
- [ ] **Ожидаемый результат**: Ошибка "Выберите тренеров для всех участников"

### Тест 2.2: Валидация ИИН
- [ ] В диалоге добавления спортсмена ввести ИИН менее 12 цифр
- [ ] **Ожидаемый результат**: Автозаполнение не срабатывает

- [ ] Ввести 12 цифр ИИН
- [ ] **Ожидаемый результат**: Автоматически заполняются дата рождения, пол, категория

---

## СЦЕНАРИЙ 3: Админ-панель заявок

### Тест 3.1: Просмотр списка заявок
- [ ] Войти как администратор
- [ ] Открыть `/ru/admin/registrations`
- [ ] Убедиться что видны:
  - Статистика (всего, на проверке, одобрено, отклонено)
  - Таблица с заявками
  - Фильтр по статусу
- [ ] **Ожидаемый результат**: Заявки отображаются корректно

### Тест 3.2: Фильтрация по статусу
- [ ] Выбрать фильтр "На проверке"
- [ ] Убедиться что показаны только заявки со статусом PENDING
- [ ] Выбрать фильтр "Одобренные"
- [ ] Убедиться что показаны только заявки со статусом APPROVED
- [ ] **Ожидаемый результат**: Фильтрация работает

### Тест 3.3: Просмотр деталей заявки
- [ ] Нажать кнопку "Глаз" у любой заявки
- [ ] Проверить что в диалоге отображается:
  - Номер заявки
  - Статус
  - Информация о турнире
  - Информация о судье (имя, категория, регион)
  - Таблица спортсменов с колонками: ФИО, ИИН, Пол, Категория, Тип лука, Тренер
  - Дата подачи и пользователь
- [ ] **Ожидаемый результат**: Все данные отображаются корректно

### Тест 3.4: Одобрение заявки
- [ ] Найти заявку со статусом "На проверке"
- [ ] Открыть детали заявки
- [ ] Нажать "Одобрить"
- [ ] **Ожидаемый результат**:
  - Статус изменился на "Одобрено"
  - Появилось уведомление об успехе
  - Заявка обновилась в списке

### Тест 3.5: Отклонение заявки
- [ ] Найти заявку со статусом "На проверке"
- [ ] Нажать кнопку отклонения (красный X)
- [ ] В диалоге ввести причину отклонения
- [ ] Нажать "Отклонить"
- [ ] **Ожидаемый результат**:
  - Статус изменился на "Отклонено"
  - Причина сохранена
  - Появилось уведомление

### Тест 3.6: Подача заявки через админ-панель
- [ ] Нажать кнопку "Подать заявку" (только для RegionalRepresentative)
- [ ] Выбрать турнир
- [ ] Выбрать категорию турнира
- [ ] Выбрать/добавить судью
- [ ] Добавить спортсменов с тренерами
- [ ] Отправить заявку
- [ ] **Ожидаемый результат**: Заявка создана и появилась в списке

---

## СЦЕНАРИЙ 4: Поиск в выпадающих списках

### Тест 4.1: Поиск спортсмена
- [ ] Открыть форму регистрации
- [ ] В поле спортсмена начать вводить имя
- [ ] **Ожидаемый результат**: Список фильтруется по введенному тексту

- [ ] Ввести ИИН
- [ ] **Ожидаемый результат**: Спортсмен найден по ИИН

### Тест 4.2: Поиск тренера
- [ ] В поле тренера начать вводить имя
- [ ] **Ожидаемый результат**: Список фильтруется

### Тест 4.3: Поиск судьи
- [ ] В поле судьи начать вводить имя
- [ ] **Ожидаемый результат**: Список фильтруется

### Тест 4.4: Очистка выбора
- [ ] Выбрать спортсмена
- [ ] Нажать кнопку очистки (X)
- [ ] **Ожидаемый результат**: Выбор сброшен

---

## СЦЕНАРИЙ 5: Мультиязычность

### Тест 5.1: Переключение языка
- [ ] Открыть форму на русском `/ru/tournaments/apply?tournamentId=[id]`
- [ ] Проверить что все тексты на русском
- [ ] Переключить на казахский `/kk/tournaments/apply?tournamentId=[id]`
- [ ] Проверить что тексты переключились
- [ ] Переключить на английский `/en/tournaments/apply?tournamentId=[id]`
- [ ] Проверить что тексты на английском
- [ ] **Ожидаемый результат**: Интерфейс корректно переводится

### Тест 5.2: Локализация категорий
- [ ] В форме проверить что:
  - Категории спортсменов (Cubs, Cadets, etc.) переведены
  - Типы луков (Recurve, Compound, Barebow) переведены
  - Категории судей переведены
- [ ] **Ожидаемый результат**: Все константы локализованы

---

## СЦЕНАРИЙ 6: Граничные случаи

### Тест 6.1: Закрытая регистрация
- [ ] Найти турнир со статусом отличным от REGISTRATION_OPEN
- [ ] Попробовать открыть страницу регистрации
- [ ] **Ожидаемый результат**: Показано сообщение "Регистрация закрыта" или редирект

### Тест 6.2: Неавторизованный пользователь
- [ ] Выйти из аккаунта
- [ ] Попробовать открыть форму регистрации
- [ ] **Ожидаемый результат**: Редирект на страницу входа

### Тест 6.3: Пустая база данных
- [ ] Если нет спортсменов в базе
- [ ] **Ожидаемый результат**: Показывается пустой список с кнопкой "Добавить нового"

---

## СЦЕНАРИЙ 7: Сохранение данных

### Тест 7.1: Новый спортсмен сохраняется в базу
- [ ] Создать заявку с новым спортсменом
- [ ] После создания открыть `/ru/admin/team`
- [ ] Найти созданного спортсмена
- [ ] **Ожидаемый результат**: Спортсмен есть в базе с правильными данными

### Тест 7.2: Новый тренер сохраняется в базу
- [ ] Создать заявку с новым тренером
- [ ] Открыть `/ru/admin/coaches`
- [ ] Найти созданного тренера
- [ ] **Ожидаемый результат**: Тренер есть в базе

### Тест 7.3: Новый судья сохраняется в базу
- [ ] Создать заявку с новым судьёй
- [ ] Открыть `/ru/admin/judges`
- [ ] Найти созданного судью
- [ ] **Ожидаемый результат**: Судья есть в базе с правильной категорией

### Тест 7.4: Связь AthleteCoach создаётся
- [ ] Создать заявку с новым спортсменом и тренером
- [ ] Открыть профиль спортсмена
- [ ] **Ожидаемый результат**: Тренер привязан к спортсмену

---

## Чек-лист быстрой проверки

### Минимальный прогон (5 минут)
- [ ] Авторизация работает
- [ ] Страница турнира открывается
- [ ] Форма регистрации загружается
- [ ] Выпадающие списки работают
- [ ] Можно выбрать спортсмена, тренера, судью
- [ ] Заявка отправляется
- [ ] Заявка появляется в админ-панели
- [ ] Можно одобрить заявку

### Полный прогон (30 минут)
- [ ] Все сценарии 1.1 - 1.6
- [ ] Все сценарии 2.1 - 2.2
- [ ] Все сценарии 3.1 - 3.6
- [ ] Все сценарии 4.1 - 4.4
- [ ] Все сценарии 5.1 - 5.2
- [ ] Все сценарии 6.1 - 6.3
- [ ] Все сценарии 7.1 - 7.4

---

## Известные ограничения

1. **Лимит спортсменов**: Максимум 4 спортсмена на одну категорию турнира (зависит от настроек турнира)
2. **Дедлайн регистрации**: Заявки не принимаются после `registrationDeadline`
3. **Уникальность**: Один спортсмен не может быть зарегистрирован дважды на одну категорию

---

## Запуск автоматических тестов

```bash
# API тесты
npx ts-node tests/registration-api.test.ts

# Тесты турниров
npx ts-node tests/tournaments-api.test.ts
```

---

## Отчёт о тестировании

| Дата | Тестировщик | Версия | Результат | Комментарии |
|------|-------------|--------|-----------|-------------|
|      |             |        |           |             |
