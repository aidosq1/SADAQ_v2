generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Athlete {
  id                      Int                      @id @default(autoincrement())
  slug                    String                   @unique
  name                    String
  nameKk                  String?
  nameEn                  String?
  iin                     String?
  dob                     String?
  gender                  String
  image                   String?
  isActive                Boolean                  @default(true)
  sortOrder               Int                      @default(0)
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @default(now())
  regionId                Int?
  regionRef               Region?                  @relation(fields: [regionId], references: [id])
  athleteRegistrations    AthleteRegistration[]
  nationalTeamMemberships NationalTeamMembership[]
  rankings                RankingEntry[]
  tournamentResults       TournamentResult[]

  @@index([isActive])
  @@index([regionId])
  @@index([gender])
}

model Coach {
  id                   Int                   @id @default(autoincrement())
  name                 String
  nameKk               String?
  nameEn               String?
  iin                  String?
  dob                  String?
  regionId             Int?
  image                String?
  isActive             Boolean               @default(true)
  sortOrder            Int                   @default(0)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now())
  athleteRegistrations AthleteRegistration[]
  region               Region?               @relation(fields: [regionId], references: [id])

  @@index([isActive])
  @@index([regionId])
}

model Judge {
  id                 Int                 @id @default(autoincrement())
  name               String
  nameKk             String?
  nameEn             String?
  iin                String?
  dob                String?
  category           String
  categoryKk         String?
  categoryEn         String?
  regionId           Int?
  image              String?
  isActive           Boolean             @default(true)
  sortOrder          Int                 @default(0)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @default(now()) @updatedAt
  region             Region?             @relation(fields: [regionId], references: [id])
  registrationJudges RegistrationJudge[]

  @@index([isActive])
  @@index([regionId])
  @@index([category])
}

model AthleteRegistration {
  id             Int          @id @default(autoincrement())
  athleteId      Int
  registrationId Int
  createdAt      DateTime     @default(now())
  coachId        Int?
  athlete        Athlete      @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  coach          Coach?       @relation(fields: [coachId], references: [id])
  registration   Registration @relation(fields: [registrationId], references: [id], onDelete: Cascade)

  @@unique([athleteId, registrationId])
  @@index([athleteId])
  @@index([registrationId])
  @@index([coachId])
}

model Document {
  id          Int      @id @default(autoincrement())
  title       String
  titleKk     String?
  titleEn     String?
  section     String
  fileUrl     String
  fileType    String?
  fileSize    Int?
  year        Int?
  sortOrder   Int      @default(0)
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  @@index([isPublished])
  @@index([section])
  @@index([year])
}

model Gallery {
  id            Int            @id @default(autoincrement())
  slug          String         @unique
  title         String
  titleKk       String?
  titleEn       String?
  description   String?
  descriptionKk String?
  descriptionEn String?
  eventDate     DateTime?
  coverImage    String?
  totalImages   Int            @default(0)
  isPublished   Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now()) @updatedAt
  images        GalleryImage[]

  @@index([eventDate])
  @@index([isPublished])
}

model GalleryImage {
  id        Int      @id @default(autoincrement())
  galleryId Int
  url       String
  title     String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  gallery   Gallery  @relation(fields: [galleryId], references: [id], onDelete: Cascade)

  @@index([galleryId])
}

model GalleryItem {
  id            Int       @id @default(autoincrement())
  title         String
  titleKk       String?
  titleEn       String?
  description   String?
  descriptionKk String?
  descriptionEn String?
  type          String    @default("photo")
  url           String
  thumbnailUrl  String?
  albumName     String?
  eventDate     DateTime?
  sortOrder     Int       @default(0)
  isPublished   Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt

  @@index([albumName])
  @@index([eventDate])
  @@index([isPublished])
}

model HistoryEvent {
  id            Int      @id @default(autoincrement())
  year          String
  title         String
  titleKk       String?
  titleEn       String?
  description   String
  descriptionKk String?
  descriptionEn String?
  iconType      String   @default("calendar")
  sortOrder     Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt

  @@index([isActive])
  @@index([sortOrder])
}

model NationalTeamMembership {
  id        Int      @id @default(autoincrement())
  athleteId Int
  category  String
  gender    String
  type      String
  joinedAt  DateTime @default(now())
  isActive  Boolean  @default(true)
  athlete   Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([athleteId, category, gender, type])
  @@index([athleteId])
  @@index([category, gender, type])
}

model News {
  id           Int      @id @default(autoincrement())
  slug         String   @unique
  title        String
  titleKk      String?
  titleEn      String?
  content      String
  contentKk    String?
  contentEn    String?
  excerpt      String?
  excerptKk    String?
  excerptEn    String?
  category     String
  image        String?
  publishedAt  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now()) @updatedAt
  showInSlider Boolean  @default(false)
  sliderOrder  Int      @default(0)

  @@index([category])
  @@index([publishedAt])
  @@index([showInSlider])
}

model Partner {
  id            Int      @id @default(autoincrement())
  name          String
  logo          String?
  websiteUrl    String?
  instagramUrl  String?
  facebookUrl   String?
  description   String?
  descriptionKk String?
  descriptionEn String?
  sortOrder     Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
}

model Protocol {
  id                   Int                 @id @default(autoincrement())
  title                String
  titleKk              String?
  titleEn              String?
  eventDate            DateTime
  location             String
  locationKk           String?
  locationEn           String?
  fileUrl              String?
  year                 Int
  sortOrder            Int                 @default(0)
  isPublished          Boolean             @default(true)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @default(now()) @updatedAt
  tournamentCategoryId Int?
  tournamentCategory   TournamentCategory? @relation(fields: [tournamentCategoryId], references: [id])

  @@index([isPublished])
  @@index([tournamentCategoryId])
  @@index([year])
}

model RankingEntry {
  id             Int      @id @default(autoincrement())
  points         Int
  rank           Int
  classification String?
  athleteId      Int
  category       String
  gender         String
  type           String
  updatedAt      DateTime @default(now()) @updatedAt
  athlete        Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)

  @@unique([athleteId, category, gender, type])
  @@index([athleteId])
  @@index([category, gender, type, points])
}

model Region {
  id            Int            @id @default(autoincrement())
  name          String
  nameKk        String?
  nameEn        String?
  director      String
  directorKk    String?
  directorEn    String?
  address       String
  addressKk     String?
  addressEn     String?
  phone         String
  email         String?
  sortOrder     Int            @default(0)
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now()) @updatedAt
  athletes      Athlete[]
  coaches       Coach[]
  judges        Judge[]
  registrations Registration[]
  users         User[]

  @@index([isActive])
}

model Registration {
  id                   Int                   @id @default(autoincrement())
  regionName           String
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now()) @updatedAt
  userId               Int
  tournamentCategoryId Int?
  approvedAt           DateTime?
  approvedBy           String?
  regionId             Int?
  registrationNumber   String                @unique
  rejectionReason      String?
  status               RegistrationStatus    @default(PENDING)
  athleteRegistrations AthleteRegistration[]
  documents            RegistrationDocument[]
  region               Region?               @relation(fields: [regionId], references: [id])
  tournamentCategory   TournamentCategory?   @relation(fields: [tournamentCategoryId], references: [id])
  user                 User                  @relation(fields: [userId], references: [id])
  registrationJudges   RegistrationJudge[]

  @@unique([tournamentCategoryId, regionId])
  @@index([tournamentCategoryId])
  @@index([userId])
  @@index([status])
  @@index([regionId])
}

model RegistrationJudge {
  id             Int          @id @default(autoincrement())
  registrationId Int
  judgeId        Int
  createdAt      DateTime     @default(now())
  judge          Judge        @relation(fields: [judgeId], references: [id])
  registration   Registration @relation(fields: [registrationId], references: [id], onDelete: Cascade)

  @@unique([registrationId, judgeId])
  @@index([registrationId])
  @@index([judgeId])
}

model RegistrationDocument {
  id             Int          @id @default(autoincrement())
  registrationId Int
  fileName       String
  fileUrl        String
  createdAt      DateTime     @default(now())
  registration   Registration @relation(fields: [registrationId], references: [id], onDelete: Cascade)

  @@index([registrationId])
}

model SiteContent {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  section   String
  value     String
  valueKk   String?
  valueEn   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([section])
}

model SiteStat {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  label     String
  labelKk   String?
  labelEn   String?
  iconType  String   @default("default")
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([isActive])
  @@index([sortOrder])
}

model Staff {
  id            Int      @id @default(autoincrement())
  name          String
  nameKk        String?
  nameEn        String?
  role          String
  roleTitle     String
  roleTitleKk   String?
  roleTitleEn   String?
  description   String?
  descriptionKk String?
  descriptionEn String?
  department    String
  image         String?
  sortOrder     Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
}

model Tournament {
  id                   Int                  @id @default(autoincrement())
  title                String
  titleKk              String?
  titleEn              String?
  startDate            DateTime
  endDate              DateTime
  location             String
  locationKk           String?
  locationEn           String?
  createdAt            DateTime             @default(now())
  description          String?
  descriptionEn        String?
  descriptionKk        String?
  isFeatured           Boolean              @default(false)
  isRegistrationOpen   Boolean              @default(true)
  registrationDeadline DateTime?
  regulationUrl        String?
  categories           TournamentCategory[]

  @@index([startDate])
  @@index([isRegistrationOpen])
}

model TournamentCategory {
  id            Int                @id @default(autoincrement())
  tournamentId  Int
  category      String
  gender        String
  type          String
  protocols     Protocol[]
  registrations Registration[]
  tournament    Tournament         @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  results       TournamentResult[]

  @@unique([tournamentId, category, gender, type])
  @@index([tournamentId])
}

model TournamentResult {
  id                   Int                @id @default(autoincrement())
  tournamentCategoryId Int
  athleteId            Int
  place                Int
  points               Int
  score                Int?
  createdAt            DateTime           @default(now())
  athlete              Athlete            @relation(fields: [athleteId], references: [id])
  tournamentCategory   TournamentCategory @relation(fields: [tournamentCategoryId], references: [id], onDelete: Cascade)

  @@unique([tournamentCategoryId, athleteId])
  @@index([athleteId])
  @@index([tournamentCategoryId])
}

model User {
  id            Int            @id @default(autoincrement())
  username      String         @unique
  password      String
  role          String         @default("RegionalRepresentative")
  createdAt     DateTime       @default(now())
  email         String?
  region        String?
  regionId      Int?
  registrations Registration[]
  regionRef     Region?        @relation(fields: [regionId], references: [id])

  @@index([regionId])
}

model Translation {
  id        Int      @id @default(autoincrement())
  namespace String
  key       String
  ru        String
  kk        String?
  en        String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([namespace, key])
  @@index([namespace])
}

enum RegistrationStatus {
  PENDING
  APPROVED
  REJECTED
  WITHDRAWN
}
